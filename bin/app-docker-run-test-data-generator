#/bin/bash

echo
echo '================================================================'
echo 'app-run-docker-test-data-generator'
echo '================================================================'
echo

APP_NAME="mldp-app-test-data-generator:latest"
APP_DOCKERFILE="../docker/applications/JavaApp/Dockerfile"
APP_BUILD_CONTEXT=".."
DOCKER_NETWORK="dp-ecosystem_eco-network"
CLIENT_CONNECT_STRING="eco-envoy:8080"

echo "üîß Building app: $APP_NAME"
docker build -f "$APP_DOCKERFILE" -t "$APP_NAME" "$APP_BUILD_CONTEXT"
if [ $? -ne 0 ]; then
  echo "‚ùå Docker build failed."
  exit 1
fi

echo "üöÄ Running app: $APP_NAME"
docker run --rm --network "$DOCKER_NETWORK"  "$APP_NAME" \
  -Ddp.GrpcClient.ingestionConnectString="$CLIENT_CONNECT_STRING" \
  -cp /app/dp-service.jar \
  com.ospreydcs.dp.service.ingest.utility.TestDataGenerator
if [ $? -ne 0 ]; then
  echo "‚ùå Docker run failed."
  exit 1
fi
