#/bin/bash

echo
echo '================================================================'
echo 'app-run-docker-test-data-generator'
echo '================================================================'
echo

APP_NAME="mldp-app-test-data-generator:latest"
APP_DOCKERFILE="../docker/applications/TestDataGenerator/Dockerfile"
APP_BUILD_CONTEXT=".."
DOCKER_NETWORK="mldp-ecosystem_grpc-network"
CLIENT_CONNECT_STRING="dp-eco-ingestion:50051"

echo "üîß Building app: $APP_NAME"
docker build -f "$APP_DOCKERFILE" -t "$APP_NAME" "$APP_BUILD_CONTEXT"
if [ $? -ne 0 ]; then
  echo "‚ùå Docker build failed."
  exit 1
fi

echo "üöÄ Running app: $APP_NAME -Ddp.GrpcClient.ingestionConnectString=$CLIENT_CONNECT_STRING"
# echo docker run --rm --network "$DOCKER_NETWORK"  "$APP_NAME" "-Ddp.GrpcClient.ingestionConnectString=$CLIENT_CONNECT_STRING com.ospreydcs.dp.service.ingest.utility.TestDataGenerator"
# docker run --rm --network "$DOCKER_NETWORK"  "$APP_NAME" "-Ddp.GrpcClient.ingestionConnectString=$CLIENT_CONNECT_STRING com.ospreydcs.dp.service.ingest.utility.TestDataGenerator"
docker run --rm --network "$DOCKER_NETWORK"  "$APP_NAME"